@model List<GeneralValuationSubs.Models.Journals>

@{
    var currentUserSurname = TempData["currentUserSurname"];
    TempData.Keep("currentUserSurname");
    var currentUserFirstname = TempData["currentUserFirstname"];
    TempData.Keep("currentUserFirstname");

    var CATDescription = TempData["CATDescription"];
    TempData.Keep("CATDescription");

    var WEF_DATE = TempData["WEF_DATE"];
    TempData.Keep("WEF_DATE");
}


<html>
<head>

    <style>
        .column {
            float: left;
            width: 33.33%;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        .php-email-form {
            box-shadow: 0 0 30px rgb(214 215 216 / 60%);
            padding: 30px;
        }

        label {
            font-weight: bolder;
        }
    </style>
</head>

<body>
    <form asp-controller="Journals" asp-action="UpdateValue" method="POST" enctype="multipart/form-data">

        <input hidden type="text" name="userName" value="@currentUserFirstname @currentUserSurname" />
        <section id="contact" class="contact">
            <div class="container">
                <div class="row justify-content-center aos-init aos-animate php-email-form" data-aos="fade-up" data-aos-delay="300">
                    <div class="col-xl-9 col-lg-12 mt-4">

                        @{
                            if (ViewBag.JournalListDetails != null)
                            {
                                foreach (var item in ViewBag.JournalListDetails)
                                {
                                    <input hidden type="text" name="Journal_Id" value="@item.Journal_Id" />

                                    <div class="row my-3">
                                        <div class="col-mt-3 form-group">
                                            <label for="PropertyDescription">Premise ID</label>
                                            <input class="form-control" id="PropertyDescription" name="PremiseId" Value="@item.Premise_ID" disabled />
                                            <input hidden class="form-control" id="MarketValueComment" name="PremiseId" Value="@item.Premise_ID" />
                                        </div>
                                    </div>

                                    <div class="row my-3">
                                        <div class="col-md-6 form-group">
                                            <label for="PremiseId">Account Number</label>
                                            <input class="form-control" id="PremiseId" name="Account_Number" Value="@item.Account_Number" disabled />
                                            <input class="form-control" hidden id="PremiseId" name="Account_Number" Value="@item.Account_Number" />
                                        </div>
                                        <div class="col-md-6 form-group">
                                            <label for="TownNameDesc">Installation</label>
                                            <input class="form-control" id="TownNameDesc" name="Installation" Value="@item.Installation" disabled />
                                            <input class="form-control" hidden id="PremiseId" name="Installation" Value="@item.Installation" />
                                        </div>

                                        @section Scripts
                                {
                                    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
                                    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
                                    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
                                    <script>
                                        $(function () {
                                            // Initialize datepickers
                                            $("#billingFrom, #billingTo").datepicker({
                                                dateFormat: 'yy-mm-dd',
                                                onSelect: calculateBillingDays
                                            });

                                            // Update calculation when the rate tariff changes
                                            $("#ratesTariffDropdown").on("change", calculateBillingDays);

                                            // Update calculation when Ratable Value or Rate Tariff changes
                                            $("#RatableValue, #rateTariffValue").on("input", calculateBillingDays);

                                            function calculateBillingDays() {
                                                var fromDate = $("#billingFrom").datepicker("getDate");
                                                var toDate = $("#billingTo").datepicker("getDate");

                                                // Get the Ratable Value and Rate Tariff from the inputs
                                                var RatableValue = parseFloat(parseCurrency($("#RatableValue").val())) || 0;
                                                var ratesTariff = parseFloat(convertCommaToDot($("#rateTariffValue").val())) || 0;

                                                if (fromDate && toDate) {
                                                    // Calculate billing days
                                                    var timeDifference = toDate - fromDate;
                                                    var dayDifference = timeDifference / (1000 * 3600 * 24);
                                                    dayDifference = dayDifference + 1; // Include both start and end date

                                                    $("#billingDays").val(dayDifference);

                                                    // Check if both Ratable Value and Rate Tariff are valid
                                                    if (RatableValue > 0 && ratesTariff > 0) {
                                                        // Calculate the rate
                                                        var rate = ((RatableValue * ratesTariff) / 365) * dayDifference;
                                                        $("#calculatedRate").val(rate.toFixed(2)); // Display rate with 2 decimal places
                                                    } else {
                                                        $("#calculatedRate").val(''); // Clear rate if either value is missing
                                                    }

                                                } else {
                                                    $("#billingDays").val('');
                                                    $("#calculatedRate").val('');
                                                }
                                            }

                                            function parseCurrency(value) {
                                                // Remove currency symbol and commas, return numeric value
                                                return value.replace(/[^\d.-]/g, '');
                                            }

                                            function convertCommaToDot(value) {
                                                // Convert comma to dot in numeric values
                                                return value.replace(',', '.');
                                            }
                                        });
                                    </script>
                                        }

                                    </div>                                   

                                    <div class="row my-3">
                                        <div class="col-md-6 form-group">
                                            <label for="ValuationType">Category</label>
                                            <input class="form-control" id="ValuationType" name="ValuationType" Value="@item.Category" disabled />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="ValuationTypeDescription">Valuation Date</label>
                                            <input class="form-control" id="ValuationDate" name="ValuationDate" Value="@item.ValuationDate" disabled />
                                        </div>
                                    </div>


                                    <div class="row my-3">
                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Billing From</label>
                                            <input class="form-control" id="billingFrom" name="billingFrom" value="@DateTime.Now.ToString("yyyy-MM-dd")" disabled readonly />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Billing To</label>
                                            <input class="form-control" id="billingTo" name="billingTo" value="@DateTime.Now.ToString("yyyy-MM-dd")" disabled readonly />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Billing Days</label>
                                            <input class="form-control" id="billingDays" name="billingDays" readonly />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="FinancialYear">Financial Year</label>
                                            <select id="FinancialYear" class="form-control" name="FinancialYear" style="height:45px;" required>
                                                <option value="" placeholder="Select Financial Year"></option>
                                                @if (ViewBag.FinancialYearList != null)
                                                {
                                                    foreach (var FinancialYearList in ViewBag.FinancialYearList)
                                                    {
                                                        <option value="@FinancialYearList.Financial_Year">@FinancialYearList.Financial_Year</option>
                                                    }
                                                }
                                            </select>
                                        </div>

                                    </div>

                                    <div class="row my-3">

                                        <div class="col-md-6 form-group">
                                            <label for="RevisedCategory">Category</label>
                                            <input id="RevisedCategoryHidden" name="RevisedCategory" hidden>
                                            <select class="form-control" id="RevisedCategory" name="CATDescription" onblur="validateField2()" style="height:45px;" required>
                                                <option selected disabled value="">Category E.g. Residential</option>
                                            </select>
                                        </div>

                                        @*<div class="col-md-6 form-group">
                                            <label for="RevisedCategory">Category</label>
                                            <input id="RevisedCategoryHidden" name="RevisedCategory" hidden>
                                            <select class="form-control" id="RevisedCategory" name="CATDescription" onblur="validateField2()" style="height:45px;" required>
                                                @{
                                                    if (@item.Category != "")
                                                    {
                                                        <option></option>
                                                    }
                                                    else
                                                    {
                                                        <option selected disabled value="">Category E.g. Residential</option>
                                                    }
                                                }
                                                @{
                                                    if (ViewBag.CategoriesList != null)
                                                    {
                                                        foreach (var cat in ViewBag.CategoriesList)
                                                        {
                                                            <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                        }
                                                    }
                                                }
                                            </select>
                                        </div>*@

                                        <div class="col-md-6 form-group">
                                            <label for="RevisedMarketValue">Market Value</label>
                                            <input class="form-control" id="MarketValue" name="Market_Value" oninput="calculateRatableValue()" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;" ondrop="return false;" maxlength="17" pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency"
                                                   placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" required />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="thresholdValue">Threshold</label>
                                            <input type="text" id="thresholdValue" name="thresholdValue" class="form-control" readonly />
                                        </div>

                                        @*<div class="col-md-6 form-group">
                                            <label for="thresholdDropdown">Threshold</label>
                                            <select id="thresholdDropdown" class="form-control" name="Threshold" style="height:45px;" onchange="calculateRatableValue()">
                                                <option value="">Select a Threshold</option>
                                                @if (ViewBag.Threshold != null)
                                                {
                                                    foreach (var threshold in ViewBag.Threshold)
                                                    {
                                                        <option value="@threshold.Threshold">@threshold.Threshold</option>
                                                    }
                                                }
                                            </select>
                                        </div>*@

                                        <div class="col-md-6 form-group mt-3 mt-md-0">
                                            <label for="RatableValue">Ratable Value</label>
                                            <input class="form-control" id="RatableValue" name="RatableValue" readonly />
                                        </div>
                                        
                                    </div>

                                    <div class="row my-3">

                                        <div class="col-md-6 form-group">
                                            <label for="rateTariffValue">Rate Tariff</label>
                                            <input type="text" id="rateTariffValue" name="rateTariffValue" class="form-control" readonly />
                                        </div>

                                        @*<div class="col-md-6 form-group">
                                            <label for="ratesTariffDropdown">Rates Tariff</label>
                                            <select id="ratesTariffDropdown" class="form-control" name="RatesTariff" style="height:45px;">
                                                <option value="">Select a Rates Tariff</option>
                                                @if (ViewBag.Rates_Tariff != null)
                                                {
                                                    foreach (var tariff in ViewBag.Rates_Tariff)
                                                    {
                                                        <option value="@tariff.Rates_Tariff">@tariff.Rates_Tariff</option>
                                                    }
                                                }
                                            </select>
                                        </div>*@

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Rebate Type</label>
                                            <input class="form-control" id="RebateType" name="RebateType" />
                                        </div>     

                                        <div class="col-md-6 form-group">
                                            <label for="RevisedMarketValue">Rebate Amount</label>
                                            <input class="form-control" id="RebateAmount" name="RebateAmount" oninput="calculateRabateAmount()" value="R 0.00" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;" ondrop="return false;" maxlength="17" pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency"
                                                   placeholder="Rebate Amount E.g. R 1,000,000.00" onblur="validateField1()" required/>
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Rates</label>
                                            <input class="form-control" id="calculatedRate" oninput="calculateRabateAmount()" name="calculatedRate" readonly />
                                        </div>

                                    </div>

                                    <div class="row my-3">

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">To be Charged </label>
                                            <input class="form-control" id="TobeCharged"  name="TobeCharged" />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Actual Billing </label>
                                            <input class="form-control" id="ActualBilling" name="ActualBilling" />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Net Adjustment</label>
                                            <input class="form-control" id="NetAdjustment" name="NetAdjustment" />
                                        </div>                                        
                                    </div>

                                    <div id="multipurposeFields" style="display: none;">
                                        <hr style="height:2px;border-width:0;color:red;background-color:red">
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue1" Value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;" ondrop="return false;" maxlength="17"
                                                       pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" disabled />
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="MarketValue1" name="MarketValue1" Value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;"
                                                       ondrop="return false;" maxlength="17" pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" />
                                            </div>
                                        </div> <!-- End First Row -->
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription1" value="@item.Category" onblur="validateField2()" style="height:45px;" disabled>
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="CATDescription1" name="CATDescription1" value="@item.Category" onblur="validateField2()" style="height:43px;">
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div> <!-- End Third Row -->
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent1">Extent</label>
                                                <input class="form-control" name="Extent1" Value="@item.Premise_ID" disabled />
                                            </div>
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent1">Extent</label>
                                                <input class="form-control" id="Extent1" name="Extent1" Value="@item.Premise_ID" />
                                            </div>
                                        </div>
                                        <hr style="height:2px;border-width:1;color:red;background-color:red">
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue2" Value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;" ondrop="return false;" maxlength="17"
                                                       pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" disabled />
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue2" value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0"
                                                       onpaste="return false;" ondrop="return false;" maxlength="17" pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" />
                                            </div>
                                        </div> <!-- End First Row --> 

                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription2" value="@item.Category" onblur="validateField2()" style="height:43px;" disabled>
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription2" value="@item.Category" onblur="validateField2()" style="height:43px;">
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div> <!-- End Third Row -->
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent2">Extent</label>
                                                <input class="form-control" id="Extent2" name="Extent2" Value="@item.Premise_ID" disabled />
                                            </div>
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent2">Extent</label>
                                                <input class="form-control" id="Extent2" name="Extent2" Value="@item.Premise_ID" />
                                            </div>
                                        </div>
                                        <hr style="height:2px;border-width:1;color:red;background-color:red">
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue3" Value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;" ondrop="return false;" maxlength="17"
                                                       pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" disabled />
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue3" value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0"
                                                       onpaste="return false;" ondrop="return false;" maxlength="17" pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" />
                                            </div>
                                        </div> <!-- End First Row -->

                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription3" value="@item.Category" onblur="validateField2()" style="height:43px;" disabled>
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription3" value="@item.Category" onblur="validateField2()" style="height:43px;">
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div> <!-- End Third Row -->
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent3">Extent</label>
                                                <input class="form-control" id="Extent3" name="Extent3" Value="@item.Premise_ID" disabled />
                                            </div>
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent3">Extent</label>
                                                <input class="form-control" id="Extent3" name="Extent3" Value="@item.Premise_ID" />
                                            </div>
                                        </div>
                                    </div>                                     
                                    <!-- MultipurposeFields -->

                                    @if (@item.Status == "Rejected")
                                    {
                                        <div class="row my-3">
                                            <div class="form-group mt-3">
                                                <label for="Comment"> Approver Comment</label>
                                                <textarea class="form-control" maxlength="250" id="ApproverComment" name="ApproverComment" disabled> @item.ApproverComment </textarea>
                                            </div>
                                        </div>
                                    }

                                    <div class="row my-3">
                                        <div class="form-group mt-3">
                                            <label for="Comment">Comment</label>
                                            <textarea class="form-control" maxlength="250" id="Comment" onchange="myFunction(this.value)" name="Comment" Value="@item.Comment" placeholder="Comment" required></textarea>
                                        </div>
                                        @*<div class="col-md-6 form-group">
                            <input class="form-control" id="MarketValueComment" name="MarketValueComment" Value="@item.CommentMarketValue" placeholder="Revised Market Value comment" required />
                            </div>
                            <div class="col-md-6 form-group mt-3 mt-md-0">
                            <input class="form-control" id="CategoryComment" name="CategoryComment" Value="@item.CommentCategory" placeholder="Revised Category comment" required />
                            </div>*@
                                    </div>

                                    <label for="evidence"> Evidence Upload </label>
                                    <span style="color:red;">(Only 30MB File Allowed)</span>
                                    <div class="row my-3">
                                        <input id="evidence" type="file" name="files" multiple data /> @*class="form-control" accept=".pdf" multiple data*@
                                    </div>
                                    //<button type="submit">Upload File</button>

                                    @if (ViewBag.Message != null)
                                    {
                                        <div class="alert" style="margin-top:20px">
                                            @ViewBag.Message
                                        </div>
                                    }

                                }
                            }

                        }


                        <div class="my-3">
                            <div class="loading">Loading</div>
                            <div class="error-message"></div>
                            <div class="sent-message">Your message has been sent. Thank you!</div>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn" style="background-color:#006570;">Update</button> 

                            @*<button type="submit" asp-controller="Home" asp-action="KillTask" asp-route-userName="@currentUserFirstname @currentUserSurname"
                                    class="btn" style="background-color: #4CAF50;"
                                    onclick="return confirm('Are you sure you want to kill the task?');">
                                Kill Task
                            </button>*@

                            <a type="button" class="btn btn-secondary"
                               asp-controller="Journals" asp-action="PropPerUser" asp-route-userName="@currentUserFirstname @currentUserSurname"
                               style="width:102px;height:44px;border-radius: 50px;padding: 10px 24px">
                                Back
                            </a>

                        </div>

                    </div>

                </div>
        </section>

        <table>
            <table id="example" class="table table-hover table-bordered dt-responsive nowrap bg-light text-dark display" style="width:100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>
                            Premise Id
                        </th>
                        <th>
                            Account Number
                        </th>
                        <th>
                            Market Value
                        </th>
                        <th>
                            Category
                        </th>
                        <th>
                            Billing From
                        </th>
                        <th>
                            Billing To
                        </th>
                        <th>
                            Billing Days
                        </th>
                        <th>
                            Threshold
                        </th>

                        <th>
                            Ratable Value
                        </th>

                        <th>
                            Rates Tariff
                        </th>    
                        
                        <th>
                            Rebate Type
                        </th>
                        <th>
                            Rebate Amount
                        </th>
                        <th>
                            Calculated Rate
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @if (ViewBag.JournalListAudit != null)
                    {
                        @foreach (var item in ViewBag.JournalListAudit)
                        {
                            <tr>
                                <td>
                                    @item.Premise_ID
                                </td>
                                <td>
                                    @item.Account_Number
                                </td>
                                <td>
                                    @item.Market_Value
                                </td>
                                <td>
                                    @item.Category
                                </td>

                                <td>
                                    @item.BillingFrom.ToString("yyyy-MM-dd")
                                </td>
                                <td>
                                    @item.BillingTo.ToString("yyyy-MM-dd")
                                </td>

                                <td>
                                    @item.BillingDays
                                </td>

                                <td>
                                    @item.Threshold
                                </td>

                                <td>
                                    @item.RatableValue
                                </td>

                                <td>
                                    @item.RatesTariff
                                </td> 

                                <td>
                                    @item.RebateType
                                </td>
                                
                                <td>
                                    @item.RebateAmount
                                </td>

                                <td>
                                    @item.calculatedRate
                                </td>
                            </tr>

                        }
                    }

                </tbody>
        </table>
        <!-- End of tiles -->
        </div>
        </div>


        <!-- Update Modal -->
        <div class="m-4">
            <div id="updateModal" class="modal fade" data-bs-backdrop="static" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Confirmation</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p>You are about to update the journal, do you want to proceed?</p>
                            @*<p class="text-secondary"><small>If you don't save, your changes will be lost.</small></p>*@
                        </div>
                        <div class="modal-footer" style="display: flex; justify-content: center;">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn" style="background-color: #E6B000;">Proceed</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div><!-- Button trigger modal -->

    </form>

    @*<script>
        document.getElementById('FinancialYear').addEventListener('change', function () {
            var financialYear = this.value;
            var categorySelect = document.getElementById('RevisedCategory');

            // Clear current categories
            categorySelect.innerHTML = '<option selected disabled value="">Category E.g. Residential</option>';

            if (financialYear) {
                // Construct the URL to fetch the JSON file based on the selected financial year
                var url = `/data/${financialYear}_categories.json`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data && Array.isArray(data)) {
                            data.forEach(function (category) {
                                if (category && category.CatDescName) {
                                    var option = document.createElement('option');
                                    option.value = category.CatDescName;
                                    option.textContent = category.CatDescName;
                                    categorySelect.appendChild(option);
                                }
                            });
                        } else {
                            var option = document.createElement('option');
                            option.value = "";
                            option.textContent = "No categories found";
                            categorySelect.appendChild(option);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                // Handle case where no financial year is selected
                var option = document.createElement('option');
                option.value = "";
                option.textContent = "Select Financial Year";
                categorySelect.appendChild(option);
            }
        });
    </script> *@   

    <script>
        function formatRebateAmount() {
            let input = document.getElementById('RebateAmount');
            let value = input.value.replace(/[^0-9.]/g, ''); // Remove non-numeric characters except decimal point
            let number = parseFloat(value);
            if (isNaN(number)) number = 0;
            input.value = "R " + number.toFixed(2); // Format to 2 decimal places
        }

        document.addEventListener('DOMContentLoaded', function () {
            let rebateInput = document.getElementById('RebateAmount');
            rebateInput.value = "R 0.00"; // Set default value on load
            rebateInput.addEventListener('input', formatRebateAmount);
        });
    </script>

    <script>
        function toggleBillingFields() {
            var financialYear = document.getElementById('FinancialYear').value;
            var category = document.getElementById('RevisedCategory').value;
            var marketValue = document.getElementById('MarketValue').value;
            var rebateAmount = document.getElementById('RebateAmount');
            var calculatedRate = document.getElementById('calculatedRate').value;

            var billingFrom = document.getElementById('billingFrom');
            var billingTo = document.getElementById('billingTo');

            // Check if all required fields are populated
            if (financialYear && category && marketValue) {
                billingFrom.disabled = false;
                billingTo.disabled = false;
            } else {
                billingFrom.disabled = true;
                billingTo.disabled = true;
            }            
        }

        // Attach event listeners to the input fields
        document.getElementById('FinancialYear').addEventListener('change', toggleBillingFields);
        document.getElementById('RevisedCategory').addEventListener('change', toggleBillingFields);
        document.getElementById('MarketValue').addEventListener('input', toggleBillingFields);

        // Optionally, call the function on page load to set initial state
        document.addEventListener('DOMContentLoaded', function () {
            toggleBillingFields();
        });
    </script>    

    <script>
        document.getElementById('FinancialYear').addEventListener('change', function () {
            var financialYear = this.value;
            var categorySelect = document.getElementById('RevisedCategory');

            // Clear current categories
            categorySelect.innerHTML = '<option selected disabled value="">Category E.g. Residential</option>';

            if (financialYear) {
                var url = `/data/${financialYear}_categories.json?v=${new Date().getTime()}`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data && Array.isArray(data)) {
                            data.forEach(function (category) {
                                if (category && category.CatDescName) {
                                    var option = document.createElement('option');
                                    option.value = category.CatDescName;
                                    option.textContent = category.CatDescName;
                                    categorySelect.appendChild(option);
                                }
                            });
                        } else {
                            var option = document.createElement('option');
                            option.value = "";
                            option.textContent = "No categories found";
                            categorySelect.appendChild(option);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                var option = document.createElement('option');
                option.value = "";
                option.textContent = "Select Financial Year";
                categorySelect.appendChild(option);
            }
        });

        document.getElementById('RevisedCategory').addEventListener('change', function () {
            var financialYear = document.getElementById('FinancialYear').value;
            var category = this.value;
            var thresholdField = document.getElementById('thresholdValue');
            var rateField = document.getElementById('rateTariffValue');

            if (financialYear && category) {
                var url = `/data/${financialYear}_categories.json?v=${new Date().getTime()}`;

                fetch(url)
                    .then(response => response.json())
                    .then(data => {
                        if (data && Array.isArray(data)) {
                            var selectedCategory = data.find(c => c.CatDescName === category);
                            if (selectedCategory) {
                                thresholdField.value = selectedCategory.Residential_Threshold;
                                rateField.value = selectedCategory.Rates_Tariff;
                            } else {
                                thresholdField.value = "Not available";
                                rateField.value = "Not available";
                            }
                        } else {
                            thresholdField.value = "Error";
                            rateField.value = "Error";
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        thresholdField.value = "Error";
                        rateField.value = "Error";
                    });
            } else {
                thresholdField.value = "";
                rateField.value = "";
            }
        });
    </script>


    <script>
        function calculateRatableValue() {
            var marketValue = document.getElementById("MarketValue").value.replace(/[^0-9.-]+/g, "");
            var threshold = document.getElementById("thresholdValue").value;

            if (marketValue && threshold) {
                var ratableValue = parseFloat(marketValue) - parseFloat(threshold);
                document.getElementById("RatableValue").value = "R " + ratableValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            } else {
                document.getElementById("RatableValue").value = "";
            }
        }       

        function calculateRabateAmount() {
            var rebateAmount = document.getElementById("RebateAmount").value.replace(/[^0-9.-]+/g, "");
            var calculatedRate = document.getElementById("calculatedRate").value.replace(/[^0-9.-]+/g, "");

            // Parse values as floats
            rebateAmount = parseFloat(rebateAmount) || 0;
            calculatedRate = parseFloat(calculatedRate) || 0;

            // Calculate the value for "To Be Charged"
            var toBeCharged = calculatedRate - rebateAmount;

            // Set the result in the "To Be Charged" input field
            document.getElementById("TobeCharged").value = "R " + toBeCharged.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }


        function onlyNumberKey(evt) {
            // Only ASCII character in that range allowed
            var ASCIICode = (evt.which) ? evt.which : evt.keyCode
            if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57))
                return false;
            return true;
        }
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        function onlyNumberKey(evt) {
            // Only ASCII character in that range allowed
            var ASCIICode = (evt.which) ? evt.which : evt.keyCode
            if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57))
                return false;
            return true;
        }

        // Jquery Dependency                                
        $("input[data-type='currency']").on({
            keyup: function () {
                formatCurrency($(this));
            },
            blur: function () {
                formatCurrency($(this), "blur");
            }
        });

        function formatNumber(n) {
            // format number 1000000 to 1,234,567
            return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ",")
        }
        function formatCurrency(input, blur) {
            // appends $ to value, validates decimal side
            // and puts cursor back in right position.                                     // get input value
            var input_val = input.val();                                     // don't validate empty input
            if (input_val === "") { return; }                                     // original length
            var original_len = input_val.length;                                     // initial caret position
            var caret_pos = input.prop("selectionStart");                                     // check for decimal
            if (input_val.indexOf(".") >= 0) {                                         // get position of first decimal
                // this prevents multiple decimals from
                // being entered
                var decimal_pos = input_val.indexOf(".");                                         // split number by decimal point
                var left_side = input_val.substring(0, decimal_pos);
                var right_side = input_val.substring(decimal_pos);                                         // add commas to left side of number
                left_side = formatNumber(left_side);                                         // validate right side
                right_side = formatNumber(right_side);                                         // On blur make sure 2 numbers after decimal
                if (blur === "blur") {
                    right_side += "00";
                }                                         // Limit decimal to only 2 digits
                right_side = right_side.substring(0, 2);                                         // join number by .
                input_val = "R " + left_side + "." + right_side;
            }
            else {
                // no decimal entered
                // add commas to number
                // remove all non-digits
                input_val = formatNumber(input_val);
                input_val = "R " + input_val;                                         // final formatting
                if (blur === "blur") {
                    input_val += ".00";
                }
            }                                     // send updated string to input
            input.val(input_val);                                     // put caret back in the right position
            var updated_len = input_val.length;
            caret_pos = updated_len - original_len + caret_pos;
            input[0].setSelectionRange(caret_pos, caret_pos);
        }
    </script>


    <script>
        function validateField1() {
            var RevisedMarketValue = document.getElementById("RevisedMarketValue");
            var RevisedCategory = document.getElementById("RevisedCategory");
            var MarketValueComment = document.getElementById("Comment");

            if (RevisedMarketValue.value.length > 0) {
                MarketValueComment.required = true;
            }
            else {
                MarketValueComment.required = false;
            }
        }
    </script>

    <script>
        function validateField2() {
            var RevisedCategory = document.getElementById("RevisedCategory");
            var CategoryComment = document.getElementById("Comment");

            if (RevisedCategory.Checked = true) {
                CategoryComment.required = true;
            }
            else {
                CategoryComment.required = false;
            }
        }
    </script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        document.getElementById("RevisedCategory").addEventListener("change", function () {
            var selectedCategory = this.value;
            if (selectedCategory === "Multiple Purposes") {
                document.getElementById("multipurposeFields").style.display = "block";
                document.getElementById("MarketValue1").required = true;
                document.getElementById("CATDescription1").required = true;
                document.getElementById("Extent1").required = true;
                // document.getElementById("RevisedMarketValue").parentNode.style.display = "none";
                // document.getElementById("RevisedMarketValue").setAttribute("disabled", true);
                document.getElementById("Extent").parentNode.style.display = "block";
                document.getElementById("Extent").required = true;
            } else {
                document.getElementById("multipurposeFields").style.display = "none";
                document.getElementById("RevisedMarketValue").parentNode.style.display = "block";
                document.getElementById("Extent").parentNode.style.display = "block";
                document.getElementById("MarketValue1").required = false;
                document.getElementById("CATDescription1").required = false;
                document.getElementById("Extent1").required = false;
                //document.getElementById("Extent").required = false;
                //document.getElementById("RevisedMarketValue").required = false;
            }
        });
    </script>

    <script>
        $(document).ready(function () {
            // Initialize the datepicker
            $("#datepicker").datepicker({
                dateFormat: 'yy-mm-dd', // Set your desired date format
                // Additional options and callbacks can be added here
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            // Initialize the datepicker
            $("#datepicker").datepicker({
                dateFormat: 'yy-mm-dd',
                onSelect: function (dateText, inst) {
                    // 'dateText' contains the selected date
                    // You can perform actions here, e.g., send it to the server
                }
            });
        });

        $('#Comment').keyup(function () {
            $(this).val($(this).val().replace(/\r?\n/gi, ''));
        });
    </script>

    <script>
        const textarea1 = document.getElementById('Comment');

        const preventEnterKey = function (textarea) {
            textarea.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                }
            });
        };

        preventEnterKey(textarea1);
    </script>


    <script type="text/javascript"
            charset="utf8"
            src="https://code.jquery.com/jquery-3.5.1.js"></script>


    <script type="text/javascript"
            charset="utf8"
            src="https://cdn.datatables.net/1.13.3/js/jquery.dataTables.min.js"></script>

    <script type="text/javascript"
            charset="utf8"
            src="https://cdn.datatables.net/1.13.3/js/dataTables.jqueryui.min.js"></script>

    <script type="text/javascript"
            charset="utf8"
            src="https://cdn.datatables.net/rowgroup/1.3.0/js/dataTables.rowGroup.min.js"></script>


    <script type="text/javascript">
        $(document).ready(function () {
            $('#example').DataTable({

            });
        });
    </script>


</body>
</html>