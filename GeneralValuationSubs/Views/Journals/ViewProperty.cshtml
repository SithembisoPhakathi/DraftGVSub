@model List<GeneralValuationSubs.Models.Journals>

@{
    var currentUserSurname = TempData["currentUserSurname"];
    TempData.Keep("currentUserSurname");
    var currentUserFirstname = TempData["currentUserFirstname"];
    TempData.Keep("currentUserFirstname");

    var CATDescription = TempData["CATDescription"];
    TempData.Keep("CATDescription");

    var WEF_DATE = TempData["WEF_DATE"];
    TempData.Keep("WEF_DATE");
}


<html>
<head>
    <style>
        .column {
            float: left;
            width: 33.33%;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        .php-email-form {
            box-shadow: 0 0 30px rgb(214 215 216 / 60%);
            padding: 30px;
        }

        label {
            font-weight: bolder;
        }
    </style>
</head>

<body>
    <form asp-controller="Journals" asp-action="UpdateValue" method="POST" enctype="multipart/form-data">

        <input hidden type="text" name="userName" value="@currentUserFirstname @currentUserSurname" />
        <section id="contact" class="contact">
            <div class="container">
                <div class="row justify-content-center aos-init aos-animate php-email-form" data-aos="fade-up" data-aos-delay="300">
                    <div class="col-xl-9 col-lg-12 mt-4">

                        @{
                            if (Model != null)
                            {
                                foreach (var item in Model)
                                {
                                    <input hidden type="text" name="Journal_Id" value="@item.Journal_Id" />

                                    <div class="row my-3">
                                        <div class="col-mt-3 form-group">
                                            <label for="PropertyDescription">Premise ID</label>
                                            <input class="form-control" id="PropertyDescription" name="PropertyDescription" Value="@item.Premise_ID" disabled />
                                            <input hidden class="form-control" id="MarketValueComment" name="PropertyDescription" Value="@item.Premise_ID" />
                                        </div>
                                    </div>

                                    <div class="row my-3">
                                        <div class="col-md-6 form-group">
                                            <label for="PremiseId">Account Number</label>
                                            <input class="form-control" id="PremiseId" name="PremiseId" Value="@item.Account_Number" disabled />
                                            <input class="form-control" hidden id="PremiseId" name="PremiseId" Value="@item.Account_Number" />
                                        </div>
                                        <div class="col-md-6 form-group">
                                            <label for="TownNameDesc">Installation</label>
                                            <input class="form-control" id="TownNameDesc" name="TownNameDesc" Value="@item.Installation" disabled />
                                            <input class="form-control" hidden id="PremiseId" name="Installation" Value="@item.Installation" />
                                        </div>

                                        @section Scripts
                                {
                                    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
                                    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
                                    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
                                    <script>
                                        $(function () {
                                            $("#billingFrom, #billingTo").datepicker({
                                                dateFormat: 'yy-mm-dd',
                                                onSelect: calculateBillingDays
                                            });

                                            function calculateBillingDays() {
                                                var fromDate = $("#billingFrom").datepicker("getDate");
                                                var toDate = $("#billingTo").datepicker("getDate");

                                                if (fromDate && toDate) {
                                                    var timeDifference = toDate - fromDate;
                                                    var dayDifference = timeDifference / (1000 * 3600 * 24);

                                                    $("#billingDays").val(dayDifference);
                                                } else {
                                                    $("#billingDays").val('');
                                                }
                                            }
                                        });
                                    </script>
                                        }
                                    </div>                                   

                                    <div class="row my-3">
                                        <div class="col-md-6 form-group">
                                            <label for="ValuationType">Category</label>
                                            <input class="form-control" id="ValuationType" name="ValuationType" Value="@item.Category" disabled />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="ValuationTypeDescription">Valuation Date</label>
                                            <input class="form-control" id="ValuationTypeDescription" name="ValuationTypeDescription" Value="@item.ValuationDate" disabled />
                                        </div>
                                    </div>


                                    <div class="row my-3">
                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Billing From</label>
                                            <input class="form-control" id="billingFrom" name="WEF_DATE" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Billing To</label>
                                            <input class="form-control" id="billingTo" name="WEF_DATE" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Billing Days</label>
                                            <input class="form-control" id="billingDays" name="WEF_DATE" readonly />
                                        </div>                                        
                                    </div>

                                    <div class="row my-3">

                                        <div class="col-md-6 form-group">
                                            <label for="RevisedCategory">Category</label>
                                            <input id="RevisedCategoryHidden" name="RevisedCategory" hidden>
                                            <select class="form-control" id="RevisedCategory" name="CATDescription" onblur="validateField2()" style="height:43px;" required>
                                                @{
                                                    if (@item.Category != "")
                                                    {
                                                        <option></option>
                                                    }
                                                    else
                                                    {
                                                        <option selected disabled value="">Category E.g. Residential</option>
                                                    }
                                                }
                                                @{
                                                    if (ViewBag.CategoriesList != null)
                                                    {
                                                        foreach (var cat in ViewBag.CategoriesList)
                                                        {
                                                            <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                        }
                                                    }
                                                }
                                            </select>
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="RevisedMarketValue">Market Value</label>
                                            <input class="form-control" id="RevisedMarketValue" name="MarketValue" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;" ondrop="return false;" maxlength="17" pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency"
                                                   placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" required />
                                        </div>

                                        <div class="col-md-6 form-group mt-3 mt-md-0">
                                            <label for="Extent">Threshold</label>
                                            <input class="form-control" id="Extent" name="Extent" />
                                        </div>

                                        <div class="col-md-6 form-group mt-3 mt-md-0">
                                            <label for="Extent">Ratable Value</label>
                                            <input class="form-control" id="Extent" name="Extent"  />
                                        </div>
                                        
                                    </div>

                                    <div class="row my-3">
                                        
                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Tarrif</label>
                                            <input class="form-control" id="datepicker" name="WEF_DATE"  />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Rebate Type </label>
                                            <input class="form-control" id="datepicker" name="WEF_DATE" />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Rebate Amount </label>
                                            <input class="form-control" id="datepicker" name="WEF_DATE" />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Rates</label>
                                            <input class="form-control" id="datepicker" name="WEF_DATE" />
                                        </div>
                                    </div>

                                    <div class="row my-3">

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">To be Charged </label>
                                            <input class="form-control" id="datepicker" name="WEF_DATE" />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Actual Billing </label>
                                            <input class="form-control" id="datepicker" name="WEF_DATE" />
                                        </div>

                                        <div class="col-md-6 form-group">
                                            <label for="datepicker">Net Adjustment</label>
                                            <input class="form-control" id="datepicker" name="WEF_DATE" />
                                        </div>                                        
                                    </div>

                                    <div id="multipurposeFields" style="display: none;">
                                        <hr style="height:2px;border-width:0;color:red;background-color:red">
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue1" Value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;" ondrop="return false;" maxlength="17"
                                                       pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" disabled />
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="MarketValue1" name="MarketValue1" Value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;"
                                                       ondrop="return false;" maxlength="17" pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" />
                                            </div>
                                        </div> <!-- End First Row -->
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription1" value="@item.Category" onblur="validateField2()" style="height:43px;" disabled>
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="CATDescription1" name="CATDescription1" value="@item.Category" onblur="validateField2()" style="height:43px;">
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div> <!-- End Third Row -->
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent1">Extent</label>
                                                <input class="form-control" name="Extent1" Value="@item.Premise_ID" disabled />
                                            </div>
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent1">Extent</label>
                                                <input class="form-control" id="Extent1" name="Extent1" Value="@item.Premise_ID" />
                                            </div>
                                        </div>
                                        <hr style="height:2px;border-width:1;color:red;background-color:red">
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue2" Value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;" ondrop="return false;" maxlength="17"
                                                       pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" disabled />
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue2" value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0"
                                                       onpaste="return false;" ondrop="return false;" maxlength="17" pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" />
                                            </div>
                                        </div> <!-- End First Row --> 

                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription2" value="@item.Category" onblur="validateField2()" style="height:43px;" disabled>
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription2" value="@item.Category" onblur="validateField2()" style="height:43px;">
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div> <!-- End Third Row -->
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent2">Extent</label>
                                                <input class="form-control" id="Extent2" name="Extent2" Value="@item.Premise_ID" disabled />
                                            </div>
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent2">Extent</label>
                                                <input class="form-control" id="Extent2" name="Extent2" Value="@item.Premise_ID" />
                                            </div>
                                        </div>
                                        <hr style="height:2px;border-width:1;color:red;background-color:red">
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue3" Value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0" onpaste="return false;" ondrop="return false;" maxlength="17"
                                                       pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" disabled />
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedMarketValue">Market Value</label>
                                                <input class="form-control" id="RevisedMarketValue" name="MarketValue3" value="@item.Market_Value" onkeypress="return onlyNumberKey(event)" min="0"
                                                       onpaste="return false;" ondrop="return false;" maxlength="17" pattern="^\R\d{1,3}(,\d{3})*(\.\d+)?$" data-type="currency" placeholder="Market Value E.g. R 1,000,000.00" onblur="validateField1()" />
                                            </div>
                                        </div> <!-- End First Row -->

                                        <div class="row my-3">
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription3" value="@item.Category" onblur="validateField2()" style="height:43px;" disabled>
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                            <div class="col-md-6 form-group">
                                                <label for="RevisedCategory">Category</label>
                                                <input id="RevisedCategory" name="RevisedCategory" hidden>
                                                <select class="form-control" id="RevisedCategory" name="CATDescription3" value="@item.Category" onblur="validateField2()" style="height:43px;">
                                                    @{
                                                        if (@item.Category != "")
                                                        {
                                                            <option selected value="@item.Category">@item.Category</option>
                                                        }
                                                        else
                                                        {
                                                            <option selected disabled value="">Category E.g. Residential</option>
                                                        }
                                                    }
                                                    @{
                                                        if (ViewBag.CategoriesList != null)
                                                        {
                                                            foreach (var cat in ViewBag.CategoriesList)
                                                            {
                                                                <option value="@cat.CatDescName">@cat.CatDescName</option>
                                                            }
                                                        }
                                                    }
                                                </select>
                                            </div>
                                        </div> <!-- End Third Row -->
                                        <div class="row my-3">
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent3">Extent</label>
                                                <input class="form-control" id="Extent3" name="Extent3" Value="@item.Premise_ID" disabled />
                                            </div>
                                            <div class="col-md-6 form-group mt-3 mt-md-0">
                                                <label for="Extent3">Extent</label>
                                                <input class="form-control" id="Extent3" name="Extent3" Value="@item.Premise_ID" />
                                            </div>
                                        </div>
                                    </div>                                     
                                    <!-- MultipurposeFields -->

                                    @if (@item.Status == "Rejected")
                                    {
                                        <div class="row my-3">
                                            <div class="form-group mt-3">
                                                <label for="Comment"> Approver Comment</label>
                                                <textarea class="form-control" maxlength="250" id="ApproverComment" name="ApproverComment" disabled> @item.ApproverComment </textarea>
                                            </div>
                                        </div>
                                    }

                                    <div class="row my-3">
                                        <div class="form-group mt-3">
                                            <label for="Comment">Comment</label>
                                            <textarea class="form-control" maxlength="250" id="Comment" onchange="myFunction(this.value)" name="Comment" Value="@item.Comment" placeholder="Comment" required></textarea>
                                        </div>
                                        @*<div class="col-md-6 form-group">
                            <input class="form-control" id="MarketValueComment" name="MarketValueComment" Value="@item.CommentMarketValue" placeholder="Revised Market Value comment" required />
                            </div>
                            <div class="col-md-6 form-group mt-3 mt-md-0">
                            <input class="form-control" id="CategoryComment" name="CategoryComment" Value="@item.CommentCategory" placeholder="Revised Category comment" required />
                            </div>*@
                                    </div>

                                    <label for="evidence"> Evidence Upload </label>
                                    <span style="color:red;">(Only 30MB File Allowed)</span>
                                    <div class="row my-3">
                                        <input id="evidence" type="file" name="files" multiple data /> @*class="form-control" accept=".pdf" multiple data*@
                                    </div>
                                    //<button type="submit">Upload File</button>

                                    @if (ViewBag.Message != null)
                                    {
                                        <div class="alert" style="margin-top:20px">
                                            @ViewBag.Message
                                        </div>
                                    }

                                }
                            }

                        }


                        <div class="my-3">
                            <div class="loading">Loading</div>
                            <div class="error-message"></div>
                            <div class="sent-message">Your message has been sent. Thank you!</div>
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn" style="background-color:#006570;">Update</button> 

                            @*<button type="submit" asp-controller="Home" asp-action="KillTask" asp-route-userName="@currentUserFirstname @currentUserSurname"
                                    class="btn" style="background-color: #4CAF50;"
                                    onclick="return confirm('Are you sure you want to kill the task?');">
                                Kill Task
                            </button>*@

                            <a type="button" class="btn btn-secondary"
                               asp-controller="Home" asp-action="PropPerUser" asp-route-userName="@currentUserFirstname @currentUserSurname"
                               style="width:102px;height:44px;border-radius: 50px;padding: 10px 24px">
                                Back
                            </a>

                        </div>

                    </div>

                </div>
        </section>
        <!-- End of tiles -->
        </div>
        </div>



        <!-- Update Modal -->
        <div class="m-4">
            <div id="updateModal" class="modal fade" data-bs-backdrop="static" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Confirmation</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p>You are about to update the draft, do you want to proceed?</p>
                            @*<p class="text-secondary"><small>If you don't save, your changes will be lost.</small></p>*@
                        </div>
                        <div class="modal-footer" style="display: flex; justify-content: center;">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn" style="background-color: #E6B000;">Proceed</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div><!-- Button trigger modal -->

    </form>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        function onlyNumberKey(evt) {
            // Only ASCII character in that range allowed
            var ASCIICode = (evt.which) ? evt.which : evt.keyCode
            if (ASCIICode > 31 && (ASCIICode < 48 || ASCIICode > 57))
                return false;
            return true;
        }

        // Jquery Dependency                                
        $("input[data-type='currency']").on({
            keyup: function () {
                formatCurrency($(this));
            },
            blur: function () {
                formatCurrency($(this), "blur");
            }
        });

        function formatNumber(n) {
            // format number 1000000 to 1,234,567
            return n.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ",")
        }
        function formatCurrency(input, blur) {
            // appends $ to value, validates decimal side
            // and puts cursor back in right position.                                     // get input value
            var input_val = input.val();                                     // don't validate empty input
            if (input_val === "") { return; }                                     // original length
            var original_len = input_val.length;                                     // initial caret position
            var caret_pos = input.prop("selectionStart");                                     // check for decimal
            if (input_val.indexOf(".") >= 0) {                                         // get position of first decimal
                // this prevents multiple decimals from
                // being entered
                var decimal_pos = input_val.indexOf(".");                                         // split number by decimal point
                var left_side = input_val.substring(0, decimal_pos);
                var right_side = input_val.substring(decimal_pos);                                         // add commas to left side of number
                left_side = formatNumber(left_side);                                         // validate right side
                right_side = formatNumber(right_side);                                         // On blur make sure 2 numbers after decimal
                if (blur === "blur") {
                    right_side += "00";
                }                                         // Limit decimal to only 2 digits
                right_side = right_side.substring(0, 2);                                         // join number by .
                input_val = "R " + left_side + "." + right_side;
            }
            else {
                // no decimal entered
                // add commas to number
                // remove all non-digits
                input_val = formatNumber(input_val);
                input_val = "R " + input_val;                                         // final formatting
                if (blur === "blur") {
                    input_val += ".00";
                }
            }                                     // send updated string to input
            input.val(input_val);                                     // put caret back in the right position
            var updated_len = input_val.length;
            caret_pos = updated_len - original_len + caret_pos;
            input[0].setSelectionRange(caret_pos, caret_pos);
        }
    </script>


    <script>
        function validateField1() {
            var RevisedMarketValue = document.getElementById("RevisedMarketValue");
            var RevisedCategory = document.getElementById("RevisedCategory");
            var MarketValueComment = document.getElementById("Comment");

            if (RevisedMarketValue.value.length > 0) {
                MarketValueComment.required = true;
            }
            else {
                MarketValueComment.required = false;
            }
        }
    </script>

    <script>
        function validateField2() {
            var RevisedCategory = document.getElementById("RevisedCategory");
            var CategoryComment = document.getElementById("Comment");

            if (RevisedCategory.Checked = true) {
                CategoryComment.required = true;
            }
            else {
                CategoryComment.required = false;
            }
        }
    </script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        document.getElementById("RevisedCategory").addEventListener("change", function () {
            var selectedCategory = this.value;
            if (selectedCategory === "Multiple Purposes") {
                document.getElementById("multipurposeFields").style.display = "block";
                document.getElementById("MarketValue1").required = true;
                document.getElementById("CATDescription1").required = true;
                document.getElementById("Extent1").required = true;
                // document.getElementById("RevisedMarketValue").parentNode.style.display = "none";
                // document.getElementById("RevisedMarketValue").setAttribute("disabled", true);
                document.getElementById("Extent").parentNode.style.display = "block";
                document.getElementById("Extent").required = true;
            } else {
                document.getElementById("multipurposeFields").style.display = "none";
                document.getElementById("RevisedMarketValue").parentNode.style.display = "block";
                document.getElementById("Extent").parentNode.style.display = "block";
                document.getElementById("MarketValue1").required = false;
                document.getElementById("CATDescription1").required = false;
                document.getElementById("Extent1").required = false;
                //document.getElementById("Extent").required = false;
                //document.getElementById("RevisedMarketValue").required = false;
            }
        });
    </script>

    <script>
        $(document).ready(function () {
            // Initialize the datepicker
            $("#datepicker").datepicker({
                dateFormat: 'yy-mm-dd', // Set your desired date format
                // Additional options and callbacks can be added here
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            // Initialize the datepicker
            $("#datepicker").datepicker({
                dateFormat: 'yy-mm-dd',
                onSelect: function (dateText, inst) {
                    // 'dateText' contains the selected date
                    // You can perform actions here, e.g., send it to the server
                }
            });
        });

        $('#Comment').keyup(function () {
            $(this).val($(this).val().replace(/\r?\n/gi, ''));
        });
    </script>

    <script>
        const textarea1 = document.getElementById('Comment');

        const preventEnterKey = function (textarea) {
            textarea.addEventListener('keydown', function (event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                }
            });
        };

        preventEnterKey(textarea1);
    </script>


</body>
</html>